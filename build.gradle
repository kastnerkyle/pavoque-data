buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath group: 'org.yaml', name: 'snakeyaml', version: '1.17'
    }
}

plugins {
    id 'base'
}

import org.yaml.snakeyaml.DumperOptions
import org.yaml.snakeyaml.Yaml

group 'de.dfki.mary'
version '0.2-SNAPSHOT'
description 'The PAVOQUE corpus of expressive speech'

ext {
    styles = ['angry', 'happy', 'neutral', 'poker', 'sad']
    yamlFiles = (styles + ['outtakes']).collect { file("pavoque-${it}.yaml") }
}

subprojects {
    apply plugin: 'base'

    repositories {
        ivy {
            url 'http://mary.dfki.de/download/pavoque-data'
            layout 'pattern', {
                artifact 'Recordings/[artifact].[ext]'
            }
        }
    }

    dependencies {
        'default' name: project.name, ext: 'tar'
    }

    task download(type: Copy) {
        from configurations.default
        into "$rootDir/Recordings"
        rename { "${project.name}.tar" }
    }
}

task yaml << {
    def options = new DumperOptions()
    options.defaultFlowStyle = DumperOptions.FlowStyle.BLOCK
    def yaml = new Yaml(options)
}

task text {
    def textDir = file("$buildDir/text")
    group 'Build'
    description "Extract utterance text as text files into $textDir"
    inputs.files yamlFiles
    outputs.dir textDir
    doFirst {
        textDir.mkdirs()
    }
    doLast {
        yamlFiles.each { yamlFile ->
            new Yaml().load(yamlFile.newReader()).each { utterance ->
                file("$textDir/${utterance.prompt - ~/[a-z]$/}.txt").text = utterance.text
            }
        }
    }
}
